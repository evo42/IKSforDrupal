GENTICS.Aloha.Format=new GENTICS.Aloha.Plugin("com.gentics.aloha.plugins.Format");GENTICS.Aloha.Format.languages=["en","de","fr","eo","fi","ru","it","pl"];GENTICS.Aloha.Format.config=["b","i","del","sub","sup","p","h1","h2","h3","h4","h5","h6","pre","removeFormat"];GENTICS.Aloha.Format.init=function(){this.initButtons();var b=this;GENTICS.Aloha.EventRegistry.subscribe(GENTICS.Aloha,"editableActivated",function(d,a){b.applyButtonConfig(a.editable.obj)})};
GENTICS.Aloha.Format.applyButtonConfig=function(b){b=this.getEditableConfig(b);for(var d in this.buttons)jQuery.inArray(d,b)!=-1?this.buttons[d].button.show():this.buttons[d].button.hide();for(var a in this.multiSplitItems)jQuery.inArray(this.multiSplitItems[a].name,b)!=-1?this.multiSplitButton.extButton.showItem(this.multiSplitItems[a].name):this.multiSplitButton.extButton.hideItem(this.multiSplitItems[a].name)};
GENTICS.Aloha.Format.initButtons=function(){this.buttons={};var b=this;this.multiSplitItems=[];jQuery.each(GENTICS.Aloha.Format.config,function(d,a){switch(a){case "b":case "i":case "cite":case "q":case "code":case "abbr":case "del":case "sub":case "sup":b.buttons[a]={button:new GENTICS.Aloha.ui.Button({iconClass:"GENTICS_button GENTICS_button_"+a,size:"small",onclick:function(){GENTICS.Aloha.activeEditable&&GENTICS.Aloha.activeEditable.obj[0].focus();var e=jQuery("<"+a+"></"+a+">"),c=GENTICS.Aloha.Selection.rangeObject,
f=c.findMarkup(function(){return this.nodeName.toLowerCase()==e.get(0).nodeName.toLowerCase()},GENTICS.Aloha.activeEditable.obj);if(f)c.isCollapsed()?GENTICS.Utils.Dom.removeFromDOM(f,c,true):GENTICS.Utils.Dom.removeMarkup(c,e,GENTICS.Aloha.activeEditable.obj);else{c.isCollapsed()&&GENTICS.Utils.Dom.extendToWord(c);GENTICS.Utils.Dom.addMarkup(c,e)}c.select();return false},tooltip:b.i18n("button."+a+".tooltip"),toggle:true}),markup:jQuery("<"+a+"></"+a+">")};GENTICS.Aloha.FloatingMenu.addButton("GENTICS.Aloha.continuoustext",
b.buttons[a].button,GENTICS.Aloha.i18n(GENTICS.Aloha,"floatingmenu.tab.format"),1);break;case "p":case "h1":case "h2":case "h3":case "h4":case "h5":case "h6":case "pre":b.multiSplitItems.push({name:a,tooltip:b.i18n("button."+a+".tooltip"),iconClass:"GENTICS_button "+b.i18n("GENTICS_button_"+a),markup:jQuery("<"+a+"></"+a+">"),click:function(){GENTICS.Aloha.activeEditable&&GENTICS.Aloha.activeEditable.obj[0].focus();GENTICS.Aloha.Selection.changeMarkupOnSelection(jQuery("<"+a+"></"+a+">"))}});break;
case "removeFormat":b.multiSplitItems.push({name:a,text:b.i18n("button."+a+".text"),tooltip:b.i18n("button."+a+".tooltip"),iconClass:"GENTICS_button GENTICS_button_"+a,wide:true,click:function(){GENTICS.Aloha.Format.removeFormat()}});break;default:GENTICS.Aloha.log("warn",this,'Button "'+a+'" is not defined');break}});if(this.multiSplitItems.length>0){this.multiSplitButton=new GENTICS.Aloha.ui.MultiSplitButton({items:this.multiSplitItems});GENTICS.Aloha.FloatingMenu.addButton("GENTICS.Aloha.continuoustext",
this.multiSplitButton,GENTICS.Aloha.i18n(GENTICS.Aloha,"floatingmenu.tab.format"),3)}GENTICS.Aloha.EventRegistry.subscribe(GENTICS.Aloha,"selectionChanged",function(d,a){jQuery.each(b.buttons,function(l,g){for(var h=0;h<a.markupEffectiveAtStart.length;h++)if(GENTICS.Aloha.Selection.standardTextLevelSemanticsComparator(a.markupEffectiveAtStart[h],g.markup)){g.button.setPressed(true);var k=true}k||g.button.setPressed(false)});if(b.multiSplitItems.length>0){for(var e=false,c=0;c<a.markupEffectiveAtStart.length&&
!e;c++)for(var f=a.markupEffectiveAtStart[c],i=0;i<b.multiSplitItems.length&&!e;i++){var j=b.multiSplitItems[i];if(j.markup)if(GENTICS.Aloha.Selection.standardTextLevelSemanticsComparator(f,j.markup)){b.multiSplitButton.setActiveItem(j.name);e=true}}e||b.multiSplitButton.setActiveItem(null)}})};
GENTICS.Aloha.Format.removeFormat=function(){GENTICS.Aloha.Selection.changeMarkupOnSelection(jQuery("<p></p>"));var b=["b","i","cite","q","code","abbr","del","sub","sup"],d=GENTICS.Aloha.Selection.rangeObject,a=jQuery(d.startContainer),e=jQuery(d.limitObject);if(!(d.isCollapsed()||a===e)){for(d=a.parent();d.get(0)!==e.get(0);){a=b.indexOf(d.get(0).nodeName.toLowerCase());d=d.parent();if(a!=-1){GENTICS.Aloha.Selection.changeMarkupOnSelection(jQuery("<"+b[a]+"></"+b[a]+">"));b.splice(a,1)}}for(var c in b){GENTICS.Aloha.Selection.changeMarkupOnSelection(jQuery("<"+
b[c]+"></"+b[c]+">"));GENTICS.Aloha.Selection.changeMarkupOnSelection(jQuery("<"+b[c]+"></"+b[c]+">"))}}};GENTICS.Aloha.Format.toString=function(){return"com.gentics.aloha.plugins.Format"};
