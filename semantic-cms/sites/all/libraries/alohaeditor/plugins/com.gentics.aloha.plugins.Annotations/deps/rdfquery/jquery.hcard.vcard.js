(function(b){testForVcardClass=function(){var d=b.rdf.databank([],{namespaces:{v:"http://www.w3.org/2006/vcard/ns#"}}),m,n=b("base");if(n&&n[0])m=m=n[0].getAttribute("href");if(!m)if((n=b("html"))&&n[0])m=m=n[0].getAttributeNS("http://www.w3.org/XML/1998/namespace","base");if(!m)if((n=b("body"))&&n[0])m=m=n[0].getAttributeNS("http://www.w3.org/XML/1998/namespace","base");n=b("*.vcard");for(var r=0;r<n.length;r++){var s=n[r],g=b("@id");g=g[0]?b.rdf.resource("<"+b.uri.base()+"#"+g[0]+">"):b.rdf.blank("[]");
var o=b.rdf.triple(g,b.rdf.type,b.rdf.resource("<http://www.w3.org/2006/vcard/ns#Vcard>"));d.add(o);o=b.rdf.blank("[]");for(var p=false,t=s.getElementsByTagName("*"),q=0;q<t.length;q++){var h=t[q],j=h.className,a=/(?:^|\s)fn(?:\s|$)/;if(a.exec(j)){var c=getTextType(h);a=b.rdf.triple(g,b.rdf.resource("<http://www.w3.org/2006/vcard/ns#fn>"),b.rdf.literal('"'+c+'"'));d.add(a);a=/^(\w+)\s+(\w+)$/;var e=a.exec(c);if(e){p=addNameNode(p,g,o,d);a=b.rdf.triple(o,b.rdf.resource("<http://www.w3.org/2006/vcard/ns#given-name>"),
'"'+e[1]+'"');e=b.rdf.triple(o,b.rdf.resource("<http://www.w3.org/2006/vcard/ns#family-name>"),'"'+e[2]+'"');d.add(a);d.add(e)}}a=/(?:^|\s)n(?:\s|$)/;if(a.exec(j))p=addNameNode(p,g,o,d);a=/(?:^|\s)given-name(?:\s|$)/;if(a.exec(j)){c=getTextType(h);a=b.rdf.triple(o,b.rdf.resource("<http://www.w3.org/2006/vcard/ns#given-name>"),b.rdf.literal('"'+c+'"'));d.add(a);p=addNameNode(p,g,o,d)}a=/(?:^|\s)family-name(?:\s|$)/;if(a.exec(j)){c=getTextType(h);a=b.rdf.triple(o,b.rdf.resource("<http://www.w3.org/2006/vcard/ns#family-name>"),
b.rdf.literal('"'+c+'"'));d.add(a);p=addNameNode(p,g,o,d)}a=/(?:^|\s)additional-name(?:\s|$)/;if(a.exec(j)){c=getTextType(h);a=b.rdf.triple(o,b.rdf.resource("<http://www.w3.org/2006/vcard/ns#additonal-name>"),b.rdf.literal('"'+c+'"'));d.add(a);p=addNameNode(p,g,o,d)}a=/(?:^|\s)honorific-prefix(?:\s|$)/;if(a.exec(j)){c=getTextType(h);a=b.rdf.triple(o,b.rdf.resource("<http://www.w3.org/2006/vcard/ns#honorific-prefix>"),b.rdf.literal('"'+c+'"'));d.add(a);p=addNameNode(p,g,o,d)}a=/(?:^|\s)honorific-suffix(?:\s|$)/;
if(a.exec(j)){c=getTextType(h);a=b.rdf.triple(o,b.rdf.resource("<http://www.w3.org/2006/vcard/ns#honorific-suffix>"),b.rdf.literal('"'+c+'"'));d.add(a);p=addNameNode(p,g,o,d)}a=/(?:^|\s)nickname(?:\s|$)/;if(a.exec(j)){c=getTextType(h);a=b.rdf.triple(g,b.rdf.resource("<http://www.w3.org/2006/vcard/ns#nickname>"),b.rdf.literal('"'+c+'"'));d.add(a)}a=/(?:^|\s)url(?:\s|$)/;if(a.exec(j)){c=getUrlType(h);if(c.indexOf("/")==0)if(m){if(m.lastIndexOf("/")==m.length-1)m=m.substring(0,m.length-1);a=b.rdf.triple(g,
b.rdf.resource("<http://www.w3.org/2006/vcard/ns#url>"),b.rdf.resource("<"+m+""+c+">"))}else a=b.rdf.triple(g,b.rdf.resource("<http://www.w3.org/2006/vcard/ns#url>"),b.rdf.resource("<"+b.uri.base()+""+c+">"));else a=c.indexOf("http://")==-1?b.rdf.triple(g,b.rdf.resource("<http://www.w3.org/2006/vcard/ns#url>"),b.rdf.literal('"'+c+'"')):b.rdf.triple(g,b.rdf.resource("<http://www.w3.org/2006/vcard/ns#url>"),b.rdf.resource("<"+c+">"));d.add(a)}a=/(?:^|\s)email(?:\s|$)/;if(a.exec(j)){c=getUrlType(h);
var l=h.getElementsByTagName("*");for(e=0;e<l.length;e++){a=l[e];var k=a.className;if(k.indexOf("type")!=-1){k=getUrlType(a);a="email";if(k.toLowerCase()=="home"||k.toLowerCase()=="personal")a="personalEmail";if(k.toLowerCase()=="work"||k.toLowerCase()=="office")a="workEmail";if(k.toLowerCase()=="mobile")a="mobileEmail";if(c.indexOf("mailto:")!=0)c="mailto:"+c;a=b.rdf.triple(g,b.rdf.resource("<http://www.w3.org/2006/vcard/ns#"+a+">"),b.rdf.resource("<"+c+">"));d.add(a)}}if(l.length==0){if(c.indexOf("mailto:")!=
0)c="mailto:"+c;if(c.indexOf("?")!=-1)c=c.substring(0,c.indexOf("?"));a=b.rdf.triple(g,b.rdf.resource("<http://www.w3.org/2006/vcard/ns#email>"),b.rdf.resource("<"+c+">"));d.add(a)}}a=/(?:^|\s)tel(?:\s|$)/;if(a.exec(j)){c=h.getElementsByTagName("*");if(c.length==0){var f=getUrlType(h);if(f.indexOf("tel:")==0)f=f.substring(4);if(f.indexOf("fax:")==0)f=f.substring(4);if(f.indexOf("modem:")==0)f=f.substring(6);a=b.rdf.triple(g,b.rdf.resource("<http://www.w3.org/2006/vcard/ns#tel>"),b.rdf.resource("<tel:"+
f+">"));d.add(a)}l=["tel"];f="";for(e=0;e<c.length;e++){a=c[e];k=a.className;if(k.indexOf("type")!=-1){k=a.getAttribute("title");if(!k)k=a.textContent;k&&k.toLowerCase()=="cell"&&l.push("mobileTel");if(k&&k.toLowerCase()=="work"||k.toLowerCase()=="office")l.push("workTel");k&&k.toLowerCase()=="fax"&&l.push("fax");k&&k.toLowerCase()=="home"&&l.push("homeTel")}else if(k.indexOf("value")!=-1)f+=a.textContent}if(f){if(f.indexOf("tel:")==0)f=f.substring(4);if(f.indexOf("fax:")==0)f=f.substring(4);if(f.indexOf("modem:")==
0)f=f.substring(6);for(q=0;q<l.length;q++){a=b.rdf.triple(g,b.rdf.resource("<http://www.w3.org/2006/vcard/ns#"+l[q]+">"),b.rdf.resource("<tel:"+f+">"));d.add(a)}}}a=/(?:^|\s)adr(?:\s|$)/;c=b.rdf.blank("[]");e="adr";if(a.exec(j)){a=s.getElementsByTagName("*");for(l=0;l<a.length;l++)if(a[l].getAttribute("class")=="type"){if(f=="home"||f=="personal")e="homeAdr";if(f=="work"||f=="office")e="workAdr"}a=b.rdf.triple(g,b.rdf.resource("<http://www.w3.org/2006/vcard/ns#"+e+">"),c);d.add(a);e=b.rdf.triple(c,
b.rdf.type,"<http://www.w3.org/2006/vcard/ns#Address>");d.add(e);l=h.getElementsByTagName("*");for(e=0;e<l.length;e++){a=l[e];f=a.textContent;a=a.className;if(a!=""){a=b.rdf.triple(c,b.rdf.resource("<http://www.w3.org/2006/vcard/ns#"+a+">"),b.rdf.literal('"'+f+'"'));d.add(a)}}}a=/(?:^|\s)label(?:\s|$)/;if(a.exec(j)){c=getTextType(h);a=b.rdf.triple(o,b.rdf.resource("<http://www.w3.org/2006/vcard/ns#label>"),b.rdf.literal('"'+c+'"'));d.add(a)}a=/(?:^|\s)geo(?:\s|$)/;if(a.exec(j)){c=h.getElementsByTagName("*");
f=getTextType(h);if(f.indexOf(";")!=-1){a=f.substring(0,f.indexOf(";"));e=f.substring(f.indexOf(";")+1);a=b.rdf.triple(g,b.rdf.resource("<http://www.w3.org/2006/vcard/ns#latitude>"),b.rdf.literal('"'+a+'"'));d.add(a);e=b.rdf.triple(g,b.rdf.resource("<http://www.w3.org/2006/vcard/ns#longitude>"),b.rdf.literal('"'+e+'"'));d.add(e)}for(e=0;e<c.length;e++){a=c[e];f=getTextType(a);a=a.className;if(a=="lat"||a=="long"){a=b.rdf.triple(g,b.rdf.resource("<http://www.w3.org/2006/vcard/ns#"+a+">"),b.rdf.literal('"'+
f+'"'));d.add(a)}}}a=/(?:^|\s)tz(?:\s|$)/;if(a.exec(j)){c=getTextType(h);a=b.rdf.triple(g,b.rdf.resource("<http://www.w3.org/2006/vcard/ns#tz>"),b.rdf.literal('"'+c+'"'));d.add(a)}a=/(?:^|\s)photo(?:\s|$)/;if(a.exec(j)){c=getUrlType(h);a=b.rdf.triple(g,b.rdf.resource("<http://www.w3.org/2006/vcard/ns#photo>"),b.rdf.resource("<"+c+">"));d.add(a)}a=/(?:^|\s)logo(?:\s|$)/;if(a.exec(j)){c=getUrlType(h);a=b.rdf.triple(g,b.rdf.resource("<http://www.w3.org/2006/vcard/ns#logo>"),b.rdf.resource("<"+c+">"));
d.add(a)}a=/(?:^|\s)sound(?:\s|$)/;if(a.exec(j)){c=getUrlType(h);a=b.rdf.triple(g,b.rdf.resource("<http://www.w3.org/2006/vcard/ns#sound>"),b.rdf.resource("<"+c+">"));d.add(a)}a=/(?:^|\s)bday(?:\s|$)/;if(a.exec(j)){c=h.getElementsByTagName("*");if(c.length==0){f=h.getAttribute("title");a=h.className;a=b.rdf.triple(g,b.rdf.resource("<http://www.w3.org/2006/vcard/ns#"+a+">"),b.rdf.literal('"'+f+'"'));d.add(a)}else for(e=0;e<c.length;e++){a=c[e];f=a.getAttribute("title");a=a.className;a=b.rdf.triple(g,
b.rdf.resource("<http://www.w3.org/2006/vcard/ns#"+a+">"),b.rdf.literal('"'+f+'"'));d.add(a)}}a=/(?:^|\s)title(?:\s|$)/;if(a.exec(j)){c=getTextType(h);a=b.rdf.triple(g,b.rdf.resource("<http://www.w3.org/2006/vcard/ns#title>"),b.rdf.literal('"'+c+'"'));d.add(a)}a=/(?:^|\s)role(?:\s|$)/;if(a.exec(j)){c=getTextType(h);a=b.rdf.triple(g,b.rdf.resource("<http://www.w3.org/2006/vcard/ns#role>"),b.rdf.literal('"'+c+'"'));d.add(a)}a=/(?:^|\s)org(?:\s|$)/;if(a.exec(j)){k=h.getElementsByTagName("*");l=b.rdf.blank("[]");
c=false;for(e=0;e<k.length;e++){a=k[e];f=getUrlType(a);a=a.className;if(f&&a){a=b.rdf.triple(l,b.rdf.resource("<http://www.w3.org/2006/vcard/ns#"+a+">"),b.rdf.literal('"'+f+'"'));d.add(a);c=true}}a=b.rdf.triple(g,b.rdf.resource("<http://www.w3.org/2006/vcard/ns#org>"),l);e=b.rdf.triple(l,b.rdf.type,b.rdf.resource("<http://www.w3.org/2006/vcard/ns#Organization>"));d.add(a);d.add(e);if(!c){c=getUrlType(h);e=b.rdf.triple(l,b.rdf.resource("<http://www.w3.org/2006/vcard/ns#organization-name>"),b.rdf.literal('"'+
c+'"'));d.add(e)}}a=/(?:^|\s)category(?:\s|$)/;if(a.exec(j)){c=getTextType(h);a=b.rdf.triple(g,b.rdf.resource("<http://www.w3.org/2006/vcard/ns#category>"),b.rdf.literal('"'+c+'"'));d.add(a)}a=/(?:^|\s)note(?:\s|$)/;if(a.exec(j)){c=getTextType(h);a=b.rdf.triple(g,b.rdf.resource("<http://www.w3.org/2006/vcard/ns#note>"),b.rdf.literal('"'+c+'"'));d.add(a)}a=/(?:^|\s)class(?:\s|$)/;if(a.exec(j)){c=getTextType(h);a=b.rdf.triple(g,b.rdf.resource("<http://www.w3.org/2006/vcard/ns#class>"),b.rdf.literal('"'+
c+'"'));d.add(a)}a=/(?:^|\s)key(?:\s|$)/;if(a.exec(j)){e=h.getAttribute("title");a=b.rdf.triple(g,b.rdf.resource("<http://www.w3.org/2006/vcard/ns#key>"),b.rdf.resource("<"+e+">"));d.add(a)}a=/(?:^|\s)mailer(?:\s|$)/;if(a.exec(j)){c=getTextType(h);a=b.rdf.triple(g,b.rdf.resource("<http://www.w3.org/2006/vcard/ns#mailer>"),b.rdf.literal('"'+c+'"'));d.add(a)}a=/(?:^|\s)uid(?:\s|$)/;if(a.exec(j)){c=getUrlType(h);a=b.rdf.triple(g,b.rdf.resource("<http://www.w3.org/2006/vcard/ns#uid>"),b.rdf.literal('"'+
c+'"'));d.add(a)}a=/(?:^|\s)rev(?:\s|$)/;if(a.exec(j)){e=h.getAttribute("title");a=b.rdf.triple(g,b.rdf.resource("<http://www.w3.org/2006/vcard/ns#rev>"),b.rdf.resource("<"+e+">"));d.add(a)}}}return d};getUrlType=function(d){return d.getAttribute("data")?d.getAttribute("data"):d.getAttribute("href")?d.getAttribute("href"):d.getAttribute("src")?d.getAttribute("src"):d.textContent};getTextType=function(d){return d.getAttribute("title")?d.getAttribute("title"):d.getAttribute("alt")?d.getAttribute("alt"):
d.textContent};addNameNode=function(d,m,n,r){if(!d){d=b.rdf.triple(m,b.rdf.resource("<http://www.w3.org/2006/vcard/ns#n>"),n);n=b.rdf.triple(n,b.rdf.type,b.rdf.resource("<http://www.w3.org/2006/vcard/ns#Name>"));r.add(d);r.add(n)}return true};gleaner=function(){var d=[],m=testForVcardClass();for(i=0;i<m.triples().length;i+=1)d.push(m.triples()[i]);return d};b.rdf.gleaners.push(gleaner)})(jQuery);
