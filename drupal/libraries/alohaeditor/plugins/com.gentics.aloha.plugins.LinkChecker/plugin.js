GENTICS.Aloha.LinkChecker=new GENTICS.Aloha.Plugin("com.gentics.aloha.plugins.LinkChecker");GENTICS.Aloha.LinkChecker.languages=["en"];GENTICS.Aloha.LinkChecker.errorCodes=[400,401,402,403,404,405,406,407,408,409,410,411,412,413,414,415,416,417,418,500,501,502,503,504,505,506];GENTICS.Aloha.LinkChecker.warningCodes=[404,411,412,413,500,503,504,505];
GENTICS.Aloha.LinkChecker.init=function(){this.proxyUrl=null;if(GENTICS.Aloha.LinkChecker.settings.proxyUrl!=undefined)this.proxyUrl=GENTICS.Aloha.LinkChecker.settings.proxyUrl;this.timer={};this.xhr={};var a=this;GENTICS.Aloha.EventRegistry.subscribe(GENTICS.Aloha,"editableActivated",function(b,d){d.editable.obj.find("a").each(function(){a.checkLink(this,jQuery(this).attr("href"),0)})});GENTICS.Aloha.EventRegistry.subscribe(GENTICS.Aloha,"editableDeactivated",function(b,d){a.makeClean(d.editable.obj)});
GENTICS.Aloha.EventRegistry.subscribe(GENTICS.Aloha,"hrefChanged",function(b,d){a.checkLink(d.obj,"hrefChanged")})};
GENTICS.Aloha.LinkChecker.checkLink=function(a,b,d,i){var f=this,c=jQuery(a).attr("href"),j=c;if(typeof c=="string"&&!/^http/.test(c.toLowerCase()))this.makeCleanLink(a);else{if(this.proxyUrl)c=this.proxyUrl+c;if(this.xhr[b]){this.xhr[b].abort();this.xhr[b]=undefined}this.timer[b]=this.urlExists(c,function(){f.makeCleanLink(a)},function(g){if(a){var h=jQuery.inArray(g.status,f.errorCodes)>=0?g.status:"0",e=jQuery(a);e.attr("title")&&!e.attr("data-invalid")&&e.attr("data-title",e.attr("title"));e.attr("data-invalid",
"true");e.attr("title",j+". "+f.i18n("error."+h));jQuery.inArray(g.status,f.warningCodes)>=0?e.addClass("GENTICS_link_warn"):e.addClass("GENTICS_link_error")}},b,i,d)}};
GENTICS.Aloha.LinkChecker.urlExists=function(a,b,d,i,f,c){var j=this;clearTimeout(this.timer[i]);c=c!=null&&c!=undefined?c:700;var g=setTimeout(function(){j.xhr[i]=jQuery.ajax({url:a,timeout:f?1E4:f,type:"HEAD",complete:function(h){clearTimeout(g);try{h.status<400?b.call(this,h):d.call(this,h)}catch(e){d.call(this,{status:0})}}})},c);return g};
GENTICS.Aloha.LinkChecker.makeCleanLink=function(a){if(a){a=jQuery(a);a.attr("data-title")?a.attr("title",a.attr("data-title")):a.removeAttr("title");a.removeAttr("data-title");a.removeAttr("data-invalid");a.removeClass("GENTICS_link_error");a.removeClass("GENTICS_link_warn")}};GENTICS.Aloha.LinkChecker.makeClean=function(a){var b=this;a.find("a").each(function(){b.makeCleanLink(this)})};
GENTICS.Aloha.LinkChecker.urlencode=function(a){a=(a+"").toString();return encodeURIComponent(a).replace(/!/g,"%21").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/\*/g,"%2A").replace(/%20/g,"+")};
