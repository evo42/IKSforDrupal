(function(a){testForVcardClass=function(){var e=a.rdf.databank([],{namespaces:{foaf:"http://xmlns.com/foaf/0.1/",geo:"http://www.w3.org/2003/01/geo/wgs84_pos#"}}),n=a.uri.base(),s=a("*.vcard"),o,r,b,j,p,k,d,h,m,c,l,t=a("[id]");for(r=0;r<s.length;r+=1){o=s[r];j=t[0]?a.rdf.resource("<#"+t[0]+">"):a.rdf.blank("[]");p=a.rdf.triple(j,a.rdf.type,a.rdf.resource("<"+f+"Person>"));e.add(p);p=o.getElementsByTagName("*");for(o=0;o<p.length;o+=1){k=p[o];h=k.className;b=/(?:^|\s)fn(?:\s|$)/;if(b.exec(h)){c=getTextType(k);
d=a.rdf.triple(j,a.rdf.resource("<"+f+"name>"),a.rdf.literal('"'+c+'"'));e.add(d);b=/^(\w+)\s+(\w+)$/;if(b=b.exec(c)){d=a.rdf.triple(j,a.rdf.resource("<"+f+"firstName>"),'"'+b[1]+'"');b=a.rdf.triple(j,a.rdf.resource("<"+f+"surname>"),'"'+b[2]+'"');e.add(d);e.add(b)}}b=/(?:^|\s)n(?:\s|$)/;b.exec(h);b=/(?:^|\s)given-name(?:\s|$)/;if(b.exec(h)){c=getTextType(k);d=a.rdf.triple(j,a.rdf.resource("<"+f+"firstName>"),a.rdf.literal('"'+c+'"'));e.add(d)}b=/(?:^|\s)family-name(?:\s|$)/;if(b.exec(h)){c=getTextType(k);
d=a.rdf.triple(j,a.rdf.resource("<"+f+"surname>"),a.rdf.literal('"'+c+'"'));e.add(d)}b=/(?:^|\s)additional-name(?:\s|$)/;b.exec(h);b=/(?:^|\s)honorific-prefix(?:\s|$)/;if(b.exec(h)){c=getTextType(k);d=a.rdf.triple(j,a.rdf.resource("<"+f+"title>"),a.rdf.literal('"'+c+'"'));e.add(d)}b=/(?:^|\s)honorific-suffix(?:\s|$)/;b.exec(h);b=/(?:^|\s)nickname(?:\s|$)/;if(b.exec(h)){c=getTextType(k);d=a.rdf.triple(j,a.rdf.resource("<"+f+"nick>"),a.rdf.literal('"'+c+'"'));e.add(d)}b=/(?:^|\s)url(?:\s|$)/;if(b.exec(h)){c=
getUrlType(k);if(c.indexOf("/")==0)if(n){if(n.lastIndexOf("/")===n.length-1)n=n.substring(0,n.length-1);d=a.rdf.triple(j,a.rdf.resource("<"+f+"homepage>"),a.rdf.resource("<"+n+""+c+">"))}else d=a.rdf.triple(j,a.rdf.resource("<"+f+"homepage>"),a.rdf.resource("<"+a.uri.base()+""+c+">"));else d=c.indexOf("http://")===-1?a.rdf.triple(j,a.rdf.resource("<"+f+"homepage>"),a.rdf.literal('"'+c+'"')):a.rdf.triple(j,a.rdf.resource("<"+f+"homepage>"),a.rdf.resource("<"+c+">"));e.add(d)}b=/(?:^|\s)email(?:\s|$)/;
if(b.exec(h)){c=getUrlType(k);l=k.getElementsByTagName("*");for(b=0;b<l.length;b+=1){d=l[b];m=d.className;if(m.indexOf("type")!=-1){getUrlType(d);if(c.indexOf("mailto:")!=0)c="mailto:"+c;d=a.rdf.triple(j,a.rdf.resource("<"+f+""+mbox+">"),a.rdf.resource("<"+c+">"));e.add(d)}}if(l.length==0){if(c.indexOf("mailto:")!=0)c="mailto:"+c;if(c.indexOf("?")!=-1)c=c.substring(0,c.indexOf("?"));d=a.rdf.triple(j,a.rdf.resource("<"+f+"mbox>"),a.rdf.resource("<"+c+">"));e.add(d)}}b=/(?:^|\s)tel(?:\s|$)/;if(b.exec(h)){l=
k.getElementsByTagName("*");if(l.length==0){c=getUrlType(k);if(c.indexOf("tel:")==0)c=c.substring(4);if(c.indexOf("fax:")==0)c=c.substring(4);if(c.indexOf("modem:")==0)c=c.substring(6);d=a.rdf.triple(j,a.rdf.resource("<"+f+"phone>"),a.rdf.resource("<tel:"+c+">"));e.add(d);var q=["phone"];c="";for(b=0;b<l.length;b++){d=l[b];m=d.className;if(m.indexOf("type")==-1)if(m.indexOf("value")!=-1)c+=d.textContent}if(c){if(c.indexOf("tel:")==0)c=c.substring(4);if(c.indexOf("fax:")==0)c=c.substring(4);if(c.indexOf("modem:")==
0)c=c.substring(6);for(o=0;o<q.length;o++){d=a.rdf.triple(j,a.rdf.resource("<"+f+""+q[o]+">"),a.rdf.resource("<tel:"+c+">"));e.add(d)}}}}b=/(?:^|\s)adr(?:\s|$)/;a.rdf.blank("[]");b.exec(h);b=/(?:^|\s)label(?:\s|$)/;b.exec(h);b=/(?:^|\s)geo(?:\s|$)/;if(b.exec(h)){m=k.getElementsByTagName("*");c=getTextType(k);if(c.indexOf(";")!=-1){b=c.substring(0,c.indexOf(";"));c=c.substring(c.indexOf(";")+1);d=a.rdf.triple(j,a.rdf.resource("<"+g+"lat>"),a.rdf.literal('"'+b+'"'));e.add(d);b=a.rdf.triple(j,a.rdf.resource("<"+
g+"long>"),a.rdf.literal('"'+c+'"'));e.add(b)}for(b=0;b<m.length;b++){d=m[b];c=getTextType(d);l=d.className;if(l=="latitude"){d=a.rdf.triple(j,a.rdf.resource("<"+g+"lat>"),a.rdf.literal('"'+c+'"'));e.add(d)}if(l=="longitude"){d=a.rdf.triple(j,a.rdf.resource("<"+g+"long>"),a.rdf.literal('"'+c+'"'));e.add(d)}}}b=/(?:^|\s)tz(?:\s|$)/;b.exec(h);b=/(?:^|\s)photo(?:\s|$)/;if(b.exec(h)){c=getUrlType(k);d=a.rdf.triple(j,a.rdf.resource("<"+f+"depiction>"),a.rdf.resource("<"+c+">"));e.add(d)}b=/(?:^|\s)logo(?:\s|$)/;
if(b.exec(h)){c=getUrlType(k);d=a.rdf.triple(j,a.rdf.resource("<"+f+"logo>"),a.rdf.resource("<"+c+">"));e.add(d)}b=/(?:^|\s)sound(?:\s|$)/;b.exec(h);b=/(?:^|\s)bday(?:\s|$)/;if(b.exec(h)){m=k.getElementsByTagName("*");if(m.length==0){c=k.getAttribute("title");l=k.className;if(l=="bday"){d=a.rdf.triple(j,a.rdf.resource("<"+f+"birthday>"),a.rdf.literal('"'+c+'"'));e.add(d)}}else for(b=0;b<m.length;b++){d=m[b];c=d.getAttribute("title");l=d.className;if(l=="bday"){d=a.rdf.triple(j,a.rdf.resource("<"+
f+"birthday>"),a.rdf.literal('"'+c+'"'));e.add(d)}}}b=/(?:^|\s)title(?:\s|$)/;if(b.exec(h)){c=getTextType(k);d=a.rdf.triple(j,a.rdf.resource("<"+f+"title>"),a.rdf.literal('"'+c+'"'));e.add(d)}b=/(?:^|\s)org(?:\s|$)/;if(b.exec(h)){var u=k.getElementsByTagName("*");m=a.rdf.blank("[]");q=false;for(b=0;b<u.length;b++){d=u[b];c=getUrlType(d);l=d.className;if(c&&l)if(l=="organization-name"){d=a.rdf.triple(m,a.rdf.resource("<"+f+"name>"),a.rdf.literal('"'+c+'"'));e.add(d);q=true}}d=a.rdf.triple(j,a.rdf.resource("<"+
f+"member>"),m);b=a.rdf.triple(m,a.rdf.type,a.rdf.resource("<"+f+"Organization>"));e.add(d);e.add(b);if(!q){c=getUrlType(k);b=a.rdf.triple(m,a.rdf.resource("<"+f+"name>"),a.rdf.literal('"'+c+'"'));e.add(b)}}b=/(?:^|\s)category(?:\s|$)/;b.exec(h);b=/(?:^|\s)note(?:\s|$)/;b.exec(h);b=/(?:^|\s)class(?:\s|$)/;b.exec(h);b=/(?:^|\s)key(?:\s|$)/;b.exec(h);b=/(?:^|\s)mailer(?:\s|$)/;b.exec(h);b=/(?:^|\s)uid(?:\s|$)/;b.exec(h);b=/(?:^|\s)rev(?:\s|$)/;b.exec(h)}}return e};getUrlType=function(e){return e.getAttribute("data")?
e.getAttribute("data"):e.getAttribute("href")?e.getAttribute("href"):e.getAttribute("src")?e.getAttribute("src"):e.textContent};getTextType=function(e){return e.getAttribute("title")?e.getAttribute("title"):e.getAttribute("alt")?e.getAttribute("alt"):e.textContent};gleaner=function(){var e=[],n=testForVcardClass();for(i=0;i<n.triples().length;i+=1)e.push(n.triples()[i]);return e};a.rdf.gleaners.push(gleaner)})(jQuery);
