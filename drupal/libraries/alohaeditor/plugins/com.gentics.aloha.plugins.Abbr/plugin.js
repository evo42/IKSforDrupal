GENTICS.Aloha.Abbr=new GENTICS.Aloha.Plugin("com.gentics.aloha.plugins.Abbr");GENTICS.Aloha.Abbr.languages=["en","de"];GENTICS.Aloha.Abbr.config=["abbr"];GENTICS.Aloha.Abbr.init=function(){this.createButtons();this.subscribeEvents();this.bindInteractions()};
GENTICS.Aloha.Abbr.createButtons=function(){var a=this;this.formatAbbrButton=new GENTICS.Aloha.ui.Button({iconClass:"GENTICS_button GENTICS_button_abbr",size:"small",onclick:function(){a.formatAbbr()},tooltip:this.i18n("button.abbr.tooltip"),toggle:true});GENTICS.Aloha.FloatingMenu.addButton("GENTICS.Aloha.continuoustext",this.formatAbbrButton,GENTICS.Aloha.i18n(GENTICS.Aloha,"floatingmenu.tab.format"),1);this.insertAbbrButton=new GENTICS.Aloha.ui.Button({iconClass:"GENTICS_button GENTICS_button_abbr",
size:"small",onclick:function(){a.insertAbbr(false)},tooltip:this.i18n("button.addabbr.tooltip"),toggle:false});GENTICS.Aloha.FloatingMenu.addButton("GENTICS.Aloha.continuoustext",this.insertAbbrButton,GENTICS.Aloha.i18n(GENTICS.Aloha,"floatingmenu.tab.insert"),1);GENTICS.Aloha.FloatingMenu.createScope(this.getUID("abbr"),"GENTICS.Aloha.continuoustext");this.abbrField=new GENTICS.Aloha.ui.AttributeField({width:320});GENTICS.Aloha.FloatingMenu.addButton(this.getUID("abbr"),this.abbrField,this.i18n("floatingmenu.tab.abbr"),
1)};GENTICS.Aloha.Abbr.bindInteractions=function(){var a=this;this.abbrField.addListener("blur",function(){this.getValue()==""&&a.removeAbbr()});for(var b=0;b<GENTICS.Aloha.editables.length;b++)GENTICS.Aloha.editables[b].obj.keydown(function(c){if(c.metaKey&&c.which==71){if(a.findAbbrMarkup()){GENTICS.Aloha.FloatingMenu.userActivatedTab=a.i18n("floatingmenu.tab.abbr");GENTICS.Aloha.FloatingMenu.doLayout();a.abbrField.focus()}else a.insertAbbr();return false}})};
GENTICS.Aloha.Abbr.subscribeEvents=function(){var a=this;GENTICS.Aloha.EventRegistry.subscribe(GENTICS.Aloha,"selectionChanged",function(b,c){if(GENTICS.Aloha.activeEditable){var d=a.getEditableConfig(GENTICS.Aloha.activeEditable.obj);if(jQuery.inArray("abbr",d)!=-1){a.formatAbbrButton.show();a.insertAbbrButton.show();if(d=a.findAbbrMarkup(c)){a.insertAbbrButton.hide();a.formatAbbrButton.setPressed(true);GENTICS.Aloha.FloatingMenu.setScope(a.getUID("abbr"));a.abbrField.setTargetObject(d,"title")}else{a.formatAbbrButton.setPressed(false);
a.abbrField.setTargetObject(null)}GENTICS.Aloha.FloatingMenu.doLayout()}else{a.formatAbbrButton.hide();a.insertAbbrButton.hide()}}})};GENTICS.Aloha.Abbr.findAbbrMarkup=function(a){if(typeof a=="undefined")a=GENTICS.Aloha.Selection.getRangeObject();return GENTICS.Aloha.activeEditable?a.findMarkup(function(){return this.nodeName.toLowerCase()=="abbr"},GENTICS.Aloha.activeEditable.obj):null};
GENTICS.Aloha.Abbr.formatAbbr=function(){var a=GENTICS.Aloha.Selection.getRangeObject();if(GENTICS.Aloha.activeEditable)this.findAbbrMarkup(a)?this.removeAbbr():this.insertAbbr()};
GENTICS.Aloha.Abbr.insertAbbr=function(a){if(!this.findAbbrMarkup(b)){GENTICS.Aloha.FloatingMenu.userActivatedTab=this.i18n("floatingmenu.tab.abbr");var b=GENTICS.Aloha.Selection.getRangeObject();b.isCollapsed()&&a!=false&&GENTICS.Utils.Dom.extendToWord(b);if(b.isCollapsed()){a=this.i18n("newabbr.defaulttext");var c=jQuery('<abbr title="">'+a+"</abbr>");GENTICS.Utils.Dom.insertIntoDOM(c,b,jQuery(GENTICS.Aloha.activeEditable.obj));b.startContainer=b.endContainer=c.contents().get(0);b.startOffset=0;
b.endOffset=a.length}else{c=jQuery('<abbr title=""></abbr>');GENTICS.Utils.Dom.addMarkup(b,c,false)}b.select();this.abbrField.focus()}};GENTICS.Aloha.Abbr.removeAbbr=function(){var a=GENTICS.Aloha.Selection.getRangeObject(),b=this.findAbbrMarkup();if(b){GENTICS.Utils.Dom.removeFromDOM(b,a,true);GENTICS.Aloha.activeEditable.obj[0].focus();a.select()}};GENTICS.Aloha.Abbr.makeClean=function(){};
